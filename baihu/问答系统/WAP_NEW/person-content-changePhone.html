<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>个人中心-更换手机号</title>
    <!--rem布局-->
    <script src="js/reset_font.js"></script>
    <link rel="stylesheet" href="font/iconfont.css">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/person-center.css">
</head>
<body style="background: #fff;">
<!--头部-->
<div class="public-head m-flex-box">
    <a href="javascript:;" class="back"><span class="back-icon"></span></a>
    <h2 class="m-flex public-head-title">验证手机号</h2>
    <a href="javascript:;" class="public-right-btn"></a>
</div>

<!--验证手机号-->
<div class="reg-phone">
    <div class="reg-phone-item m-flex-box">
            <div class="reg-phone-item-l">原手机号</div>
            <div class="m-flex reg-phone-item-inp"><input type="text" placeholder="请输入原手机号" id="bind-phone"></div>
    </div>
    <div class="reg-phone-item m-flex-box">
        <div class="reg-phone-item-l">短信验证码</div>
        <div class="m-flex reg-phone-item-inp"><input type="text" placeholder="请输入验证码" id="code"></div>
        <div class="reg-phone-item-btn"><input type="button" value="获取验证码" class="send-code"></div>
    </div>
    <a href="javascript:;" class="btn bind-reg _js_reg_btn">验证手机</a>
</div>

</body>
</html>
<script src="js/jquery-1.11.2.min.js"></script>
<script src="plug/layer_mobile/layer.js"></script>
<script src="js/main.js"></script>
<script>
    //验证函数
    function reg_phone(data) {
        if (!data) {
            return;
        }
        var phone = $.trim($(data.phone).val()),
            code = $.trim($(data.code).val()),
            reg_phone = data.reg;

        if (phone == "") {
            layer.open({
                skin: "msg",
                content: "请输入手机号",
                time: 1
            });
            return false;
        } else if (!reg_phone.test(phone)) {
            layer.open({
                skin: "msg",
                content: "请输入正确手机号",
                time: 1
            });
            return false;
        } else if (data.code) {
            if (code == "") {
                layer.open({
                    skin: "msg",
                    content: "请输入验证码",
                    time: 1
                });

                return false;
            }
        }

        return true;

    }



//    验证原来手机号
    $('._js_reg_btn').on('click',function(){
        var bindPhone = reg_phone({
            phone: "#bind-phone",
            code: "#code",
            reg: /0?(13|14|15|18)[0-9]{9}/
        });
        if(!bindPhone){
            return false;
        }

    });


    $('.send-code').on('click', function() {
        var bindPhone2 = reg_phone({
            phone: "#bind-phone",
            reg: /0?(13|14|15|18)[0-9]{9}/
        });
        if (!bindPhone2) {
            return false;
        }
        time_down();
    });



    var time_down = function() {
        //手机验证倒计时
        var timer = null; //timer变量，控制时间
        var count = 60; //间隔函数，1秒执行
        var curCount = 0; //当前剩余秒数
        var code = ""; //验证码
        var codeLength = 6; //验证码长度

        function sendMessage() {



            curCount = count;

            //设置button效果，开始计时
            $(".send-code").attr("disabled", "true");
            $(".send-code").val(curCount + "s");
            $(".send-code").addClass('active');
            timer = window.setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次
            SetRemainTime();


        }
        //timer处理函数
        function SetRemainTime() {
            if (curCount == 0) {
                window.clearInterval(timer); //停止计时器
                $(".send-code").removeAttr("disabled"); //启用按钮
                $(".send-code").removeClass('active');
                $(".send-code").val("重新发送");

                // code = ""; //清除验证码。如果不清除，过时间后，输入收到的验证码依然有效
            } else {
                curCount--;
                $(".send-code").val(curCount + "s");
            }
        }



        return sendMessage();

    }
</script>