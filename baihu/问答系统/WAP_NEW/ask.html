<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>提问</title>
    <!--rem布局-->
    <script src="js/reset_font.js"></script>
    <link rel="stylesheet" href="font/iconfont.css">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/ask.css">
</head>
<body>
<!--头部-->
<div class="public-head m-flex-box">
    <a href="javascript:;" class="back"><span class="back-icon"></span></a>
    <h2 class="m-flex public-head-title">提问</h2>
    <a href="javascript:;" class="public-right-btn js-publish-btn">发布</a>
</div>

<!--提问-->
<div class="ask-wrap">

    <div class="mg15 ask-item">
        <div class="ask-item-top">
            <h2 class="ask-title">问题标题</h2>
            <input type="text" placeholder="请输入问题标题" id="ask-title">
        </div>
        <div class="ask-item-area">
            <h2 class="ask-title">问题内容</h2>
            <textarea name="" id="ask-area"  placeholder="仔细描述问题的具体情况得到的答案更精选哦..."></textarea>
        </div>
        <div class="upload-box">
            <ul class="upload-list m-flex-box flex-hw"></ul>
            <div class="upload-btn"><input type="file" id="myFile" name="image[]" multiple></div>
            <p>1.可上传患处、病历、检查单等图片(皮肤和整形问题请务必上传患处)；</p>
            <p>2.您上传的图片仅您和医生登录后可见；</p>
            <p>3.最多上传3张，单张照片小于2M。</p>
        </div>
    </div>

    <!--填写用户信息-->
    <div class="mg15 ask-item">
        <div class="user-info-fill">
            <h2 class="fill-title">填写用户信息</h2>
            <div class="m-flex-box user-info-fill-item">
                <div class="fill-sex">患者性别</div>
                <div class="m-flex fill-sex-choose">
                    <span class="sex-box active" data-id = "0"><b class=""></b>男 </span>
                    <span class="sex-box" data-id = "1"><b></b>女 </span>
                </div>
            </div>
            <div class="m-flex-box user-info-fill-item">
                <div class="fill-sex">患者年龄</div>
                <div class="m-flex fill-sex-inp">
                    <input type="text" id="ask-age">
                </div>
            </div>
        </div>
    </div>
    <!--悬赏-->
    <div class="ask-item reward-box">
        <h2 class="fill-title">悬赏</h2>
        <div class="m-flex-box reward-jifen reward-box-item">
            <div class="m-flex"><input type="text" class="reward-input" placeholder="0积分" id="ask-jifen"></div>
            <div class="reward-num-box">(当前共有 <span class="has-number">0</span> 积分)</div>
        </div>
        <div class="message-inform reward-box-item">
            <b class="" ></b>收到答案时短信通知我 <span>151****8593</span>
            <a href="javascript:;">(更改)</a>
        </div>
        <div class="anonymity reward-box-item">
            匿名提问
            <span class="anonymity-btn "><b class="anonymity-btn-arc"></b></span>
        </div>
    </div>
</div>

<!--底部固定-->
<div class="footer-fixed">
    <a href="index.html">
        <span class="iconfont icon-shouye"></span>
        首页
    </a>
    <a href="javascript:;"  class="active"> <span class="iconfont icon-message"></span>提问</a>
    <a href="doctor-list.html"> <span class="iconfont icon-yishengxuanze"></span>医生</a>
    <a href="person-content.html"> <span class="iconfont icon-wode"></span>我的</a>
</div>
</body>
</html>
<script src="js/jquery-1.11.2.min.js"></script>
<script src="plug/layer_mobile/layer.js"></script>
<script src="js/main.js"></script>
<script>
    //提问验证


    ;(function($,win,doc,undefined){

        var ask_reg = function(data){
            if(!data) return ;

            this.container = data.container;

            this.title = $.trim($(this.container).find('#ask-title').val());//问题标题

            this.area  = $.trim($(this.container).find('#ask-area').val());//问题描述

            this.age   = $.trim($(this.container).find('#ask-age').val());//患者年龄

            this.sex   =  $(this.container).find('.fill-sex-choose');//性别选择

            this.integral = $.trim($(this.container).find('#ask-jifen').val());//输入积分

            this.hasIntegral = Math.floor($(this.container).find('has-number').text());//拥有积分

            this.messgaePhone = $(this.container).find('.message-inform');//短息通知按钮

            this.anonymity =  $(this.container).find('.anonymity-btn ');

            this.init();
        }


        ask_reg.prototype = {
            init:function(){
                this.event_bind();

            },
            reg_inp:function(){
                var _this = this;

                if(this.title==""){
                    layer.open({
                        skin:"msg",
                        content:"请输入问题标题",
                        time:1
                    });
                    this.scroll_top($('#ask-title').offset().top);
                    return false;
                }else if(this.area==""){
                    layer.open({
                        skin:"msg",
                        content:"请对问题进行描述",
                        time:1
                    });
                    this.scroll_top($('#ask-area').offset().top);
                    return false;
                }else if(this.age==""){
                    layer.open({
                        skin:"msg",
                        content:"请填写患者年龄",
                        time:1
                    });
                    this.scroll_top($('#ask-age').offset().top);
                    return false;
                }else if(isNaN(this.age)){
                    layer.open({
                        skin:"msg",
                        content:"请正确填写年龄",
                        time:1
                    });
                    this.scroll_top($('#ask-age').offset().top);
                    return false;
                }else if(this.integral>this.hasIntegral){
                    layer.open({
                        skin:"msg",
                        content:"您的积分不足",
                        time:1
                    });
                    this.scroll_top($('#ask-jifen').offset().top);
                    return false;
                }

                return true;




            },
            event_bind:function(){
                var _this =  this;
                //患者性别选择

                this.sex.on('click','.sex-box',function(){
                      var dataId = $(this).attr('data-id');


                          $(this).addClass('active').siblings().removeClass('active');


                });

                //是否短信提醒
                this.messgaePhone.on('click',function(){
                    $(this).find('b').toggleClass('active');

                    if( $(this).find('b').hasClass('active')){
                        $(this).find('b').attr('data-id',3);
                    }else{
                        $(this).find('b').removeAttr('data-id');
                    }

                });


                //是否匿名提问

                this.anonymity.on('click',function(){
                    $(this).toggleClass('active');
                    if($(this).hasClass('active')){
                        $(this).attr('data-id','4');
                    }else{
                        $(this).removeAttr('data-id');
                    }
                });

            },
            scroll_top:function(scrollY){

                $('body,html').animate({scrollTop:scrollY},500);
            }



        }

        window.ask_reg = ask_reg;

    })(jQuery,window,document);
        //初始化
       var reg =  new ask_reg({
            container:".ask-wrap"
        });

        $('.js-publish-btn').on('click',function(){
            var reg2 =  new ask_reg({
                container:".ask-wrap"
            });

            if(!reg2.reg_inp()){
                return false;
            }
        });


    //上传图片
    ;(function(){
        var objUrl;
        var img_html;

        $("#myFile").change(function() {
            var img_div = $(".upload-list");
            var filepath = $("input[name='image[]']").val();
            var files = $("#myFile").get(0).files;
            var arr =[];
            for(var i = 0; i < files.length; i++) {
//          objUrl = getObjectURL(files[i]);

                var extStart = filepath.lastIndexOf(".");
                var ext = filepath.substring(extStart, filepath.length).toUpperCase();
                /*

                 描述：鉴定每个图片上传尾椎限制
                 * */
                if(ext != ".BMP" && ext != ".PNG" && ext != ".GIF" && ext != ".JPG" && ext != ".JPEG") {
                    layer.open({
                        skin:"msg",
                        content:"请选择图片后上传",
                        time:1
                    });
                    this.value = "";

                    return false;
                }
            }





                if(files.length>=4){
                    layer.open({
                        skin:"msg",
                        content:"最多上传4张",
                        time:1
                    });
                    return;
                }else if(img_div.find('li').length>=4){
                    layer.open({
                        skin:"msg",
                        content:"最多上传4张",
                        time:1
                    });
                    return;
                }

                $.each(files, function(index,el) {


                    var src= getObjectURL(el);

                    var imgObj = new Image();
                    imgObj.src = src;
                    layer.open({type: 2});

                    img_html =
                        '<li class="">'+
                        '<img src='+ imgObj.src + ' >'+

                        '<div class="del-box">'+
                        '<span class="iconfont icon-shanchu del"></span>'+
                        '</div>'+
                        '</li>';
                    imgObj.onload = function(){

                        layer.open({type: 2,time:0.1});

                    }

                    img_div.append(img_html);


                });


        });

        function getObjectURL(file) {
            var url = null;
            if(window.createObjectURL != undefined) { // basic
                url = window.createObjectURL(file);
            } else if(window.URL != undefined) { // mozilla(firefox)
                url = window.URL.createObjectURL(file);
            } else if(window.webkitURL != undefined) { // webkit or chrome
                url = window.webkitURL.createObjectURL(file);
            }
            //console.log(url);
            return url;
        }
        //删除

        function removeImg(r){

            layer.open({
                content:"确定要删除吗？",
                btn: ['确定','取消'] ,//按钮
                yes:function(){
                    $("#myFile").val("");
                    $(r).closest('li').remove();
                    layer.open({
                        skin:"msg",
                        content:"删除成功",
                        time:0.5
                    });
                }
            });

        }

        $(document).on('click','.del-box',function(){

            removeImg(this);
        });

    })();


</script>