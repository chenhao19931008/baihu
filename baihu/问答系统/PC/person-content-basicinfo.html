<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>个人中心</title>
    <link rel="stylesheet" href="font/iconfont.css" />
    <link rel="stylesheet" href="plug/cropper/css/cropper.min.css">
    <link rel="stylesheet" href="plug/cropper/css/main.css">
    <link rel="stylesheet" href="css/global.css" />
    <!--个人中心-->
    <link rel="stylesheet" href="css/person-content.css">
</head>
<body>

<!--头部信息-->
<div class="head-wrap">
    <div class="container head clearfix">
        <div class="left head-l">
            <span>你好，欢迎来到白狐医疗问答系统</span>
            <span class="hot-line"><i class="iconfont icon-dianhua1"></i>客服热线    &nbsp;&nbsp;  400-622-2976</span>
        </div>
        <div class="right head-r" >
            <ul class="head-r-list clearfix">

                <li><a href="javascript:;" class="blue">登录</a></li>
                <li><a href="#">|</a></li>
                <li><a href="javascript:;" class="blue">注册</a></li>
            </ul>
            <div class="current logined clearfix head-r-list">
                <a href="javascript:;" class="left signin" id="js-just-qiandao">签到</a>
                <a href="javascript:;" class="left message">
                    <i class="iconfont icon-2kaoshikouyutilabaicon"></i>消息
                    <span class="message-icon">9</span>
                </a>
                <div class="right menu-list-wrap">
                    <a href="javascript:;" class="user-pic"><img src="img/head.png" alt=""></a>
                    <ul class="menu-list">
                        <li><a href="javascript:;" class="font-sl">积分 <span class="yellow">99</span></a></li>
                        <li><a href="javascript:;">我的主页</a></li>
                        <li><a href="javascript:;">我的关注</a></li>
                        <li><a href="javascript:;">我的提问</a></li>
                        <li><a href="javascript:;">退出</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!--个人中心-->
<div class="person-content">
    <!--头部-->
    <div class="person-content-top">
            <div class="container person-content-top-in">
                <a href="javascript:;" class="left logo"><img src="img/center/logo.png" alt=""></a>
                <div class="person-content-search right">
                    <form action="#">
                        <div class="person-content-search-in">
                            <input type="text" class="search-inp">
                            <button class="search-btn"><i class="iconfont icon-sousuo"></i></button>
                        </div>
                    </form>
                </div>
            </div>
    </div>
    <!--内容区域-->
    <div class="container person-content-main clearfix">
        <div class="left person-content-main-l">
            <ul class="nav-list">
                <li><a href="person-content.html"> <i class="icon person-icon"></i>个人中心</a></li>
                <li><a href="javascript:;"  class="active"><i class="icon basic-icon"></i>基本资料</a></li>
                <li><a href="person-content-attention.html"><i class="icon att-icon"></i>我的关注</a></li>
                <li><a href="person-answer.html"><i class="icon ask-icon"></i>我的回答</a></li>
                <li><a href="person-message.html"><i class="icon message-icon"></i>我的消息</a></li>
                <li><a href="person-bind.html"><i class="icon zh-icon"></i>账号绑定</a></li>
                <li><a href="person-change-pass.html"><i class="icon pass-icon"></i>修改密码</a></li>
                <li><a href="person-wallet.html"><i class="icon qb-icon"></i>我的钱包</a></li>
            </ul>
        </div>
        <!--右侧-->
        <div class="right person-content-main-r">
                <div class="person-content-basic">
                    <div class="person-content-basic-title">

                        <a href="javascript:;">我的信息</a>
                    </div>
                    <div class="person-content-basic-form">
                        <!--<form action="#">-->
                            <!--称号-->
                            <dl class="clearfix">
                                <dt class="left">称号</dt>
                                <dd class="left">
                                    <input type="text" class="inp" value="haha">
                                </dd>
                            </dl>
                            <!--性别-->
                            <dl class="clearfix">
                                <dt class="left">性别</dt>
                                <dd class="left choose-sex">
                                    <span>
                                        <label>
                                             <input type="radio" name="sex" checked="true">
                                             男
                                        </label>
                                    </span>

                                       <span>
                                            <label>
                                              <input type="radio" name="sex">
                                                女
                                            </label>
                                       </span>
                                </dd>
                            </dl>
                            <!--出生日期-->
                            <dl class="clearfix">
                                <dt class="left">出生日期</dt>
                                <dd class="left">
                                    <input type="text" class="inp" id="date" onclick="laydate()" value="2017-02-25">
                                </dd>
                            </dl>
                            <!--上传头像-->
                            <dl class="clearfix">
                                <dt class="left">上传头像</dt>
                                <!--<dd class="left"><img id="headerimg" src="img/doc01.png" alt="" style="width: 200px;height: 170px;margin-right: 20px;"></dd>-->
                                <dd class="left">

                                    <div class="userlogo">
                                        <div class="avatar" id="_j_avatar_box">
                                            <img src="https://b2-q.mafengwo.net/s10/M00/35/15/wKgBZ1i2PAiAerfBABn-6BpKpl0458.png?imageMogr2%2Fthumbnail%2F%21120x120r%2Fgravity%2FCenter%2Fcrop%2F%21120x120%2Fquality%2F90" width="120" height="120" border="0">
                                            <div class="progress" id="percentContent" style="display:none;">
                                                <div class="bar">
                                                    <div class="num" id="percentNum">0%</div>
                                                    <div class="on" style="width:0%" id="uploadPercent"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="btn-sub">
                                            <div class="btn" id="_j_upload">选择图片</div>支持jpg、png、jpeg、bmp，图片大小5M以内
                                        </div>
                                        <div class="editor" id="_j_crop_box">
                                            <div class="clearfix">
                                                <div class="plan">
                                                    <img src="img/doc01.png">
                                                </div>
                                                <div class="preview">
                                                    <dl class="large">
                                                        <dt><img src="img/doc01.png"></dt>
                                                        <dd>120*120</dd>
                                                    </dl>
                                                    <dl class="normal">
                                                        <dt><img src="img/doc01.png"></dt>
                                                        <dd>48*48</dd>
                                                    </dl>
                                                    <dl class="small">
                                                        <dt><img src="img/doc01.png"></dt>
                                                        <dd>16*16</dd>
                                                    </dl>
                                                </div>
                                            </div>
                                            <div class="btns">
                                                <a href="#" class="btn1">保存</a>
                                                <a href="#" class="btn2">取消</a>
                                            </div>
                                        </div>
                                    </div>

                                </dd>
                            </dl>
                            <div class="save-box">
                                <button class="save-btn">保存</button>
                            </div>
                        <!--</form>-->
                    </div>
                </div>

        </div>
    </div>

</div>
<div class="data-picker-wrap">
    <div class="data-picker-in">
        <span class="data-close"><i class="iconfont icon-guanbi"></i></span>
        <div class="data-top">
            <p>已连续签到 <strong class="blue">2</strong> 天</p>
        </div>
        <div class="claeafix data-bot">
            <div id="data-picker" class="left">
                <div style="width:320px;" id="calendar"></div>
            </div>
            <div class="left data-bot-right">
                <p>今日获得积分 <span class="blue"> 4</span></p>
                <p>当前积分 <span class="blue"> 4</span></p>
                <dl class="">
                    <dt>签到规则</dt>
                    <dd>首次签到科获得4个积分奖励</dd>
                    <dd>连续签到每天增加2个积分奖励</dd>
                    <dd>连续签到10天以上每天获得16个
                        积分奖励</dd>
                </dl>
            </div>
        </div>
    </div>

</div>
<!--footer-->
<div class="footer">
    <div class="container">
        <div class="footer-top clearfix">
            <a href="javascript:;">首页</a>
            <a href="javascript:;">公司简介</a>
            <a href="javascript:;">在线帮助</a>
            <a href="javascript:;">渠道招商</a>
            <a href="javascript:;">定制服务</a>
            <a href="javascript:;" class="border-right-none">升级计划</a>
        </div>
        <div class="footer-bot">
            <p>Copyright 2010-2015 All Rights Reserved. 苏ICP备123123123号-1（苏）医广[2012]第12-17-659号 苏卫网审（2011）174号</p>
            <p>全国统一客服电话：400-622-2972</p>
        </div>
    </div>
</div>
</body>
</html>
<script src="js/jquery-1.11.2.min.js"></script>
<script src="plug/layer/laydate/laydate.js"></script>
<script src="plug/cropper/js/jcrop.js"></script>
<script src="js/globle.js"></script>
<script src="js/qiandao.js"></script>
<script>

//       $('#avatarInput').change(function () {
//           $('#crop-content').show();
//           $("#headerimg").hide();
//
//       });

    //日历

       $('.signin').on('click',function(){

           $('.data-picker-wrap').addClass('active');

           var date = new Date();

           var day = date.getDate();


           //签到
           //ajax获取日历json数据
           var signList=[{"signDay":"25"},{"signDay":"11"},{"signDay":"12"},{"signDay":"13"}];//已签到数据
           signList.push({"signDay":day});
           calUtil.init(signList);
       });


       $('.data-close').on('click',function(){

           $('.data-picker-wrap').removeClass('active');

       });





</script>

<script>



    $(function(){
        var boundX = 0, boundY = 0;
        var avatar;
        var avatarBox = $('#_j_avatar_box');
        var cropApi, cropX = 0, cropY = 0, cropWidth = 0, cropHeight = 0;
        var cropBox = $('#_j_crop_box');
        var updatePreview = function(crop) {
            if(parseInt(crop.w) > 0) {
                var largeX = 120 / crop.w;
                var largeY = 120 / crop.h;
                var normalX = 48 / crop.w;
                var normalY = 48 / crop.h;
                var smallX = 16 / crop.w;
                var smallY = 16 / crop.h;

                cropX = crop.x;
                cropY = crop.y;
                cropWidth = crop.w;
                cropHeight = crop.h;

                cropBox.find('.preview .large img').css({
                    width: Math.round(largeX * boundX),
                    height: Math.round(largeY * boundY),
                    marginLeft: -Math.round(largeX * crop.x),
                    marginTop: -Math.round(largeY * crop.y)
                });
                cropBox.find('.preview .normal img').css({
                    width: Math.round(normalX * boundX),
                    height: Math.round(normalY * boundY),
                    marginLeft: -Math.round(normalX * crop.x),
                    marginTop: -Math.round(normalY * crop.y)
                });
                cropBox.find('.preview .small img').css({
                    width: Math.round(smallX * boundX),
                    height: Math.round(smallY * boundY),
                    marginLeft: -Math.round(smallX * crop.x),
                    marginTop: -Math.round(smallY * crop.y)
                });
            }
        };
        var avatarUploader = new plupload.Uploader({
            runtimes: 'html5,flash',
            browse_button: '_j_upload',
            flash_swf_url: '/swf/Moxie.swf',
            multi_selection: false,
            filters: [{
                title: 'Image files',
                extensions: 'jpg,jpeg,png,gif'
            }],
            url: '/home/setting.php/uploadAvatar',
            resize: {
                width: 2048,
                quality: 100
            },
            multipart: 'form-data'
        });

        avatarUploader.init();
        avatarUploader.bind('FilesAdded', function() {
            if(typeof cropApi !== 'undefined') {

                cropApi.destroy();
                cropBox.find('.btns a').addClass('disable');
            }
            cropBox.find('.plan img,.preview dl img')
                .removeAttr('style')
                .attr('src', 'img/doc01.png');
            cropX = cropY = cropWidth = cropHeight = 0;
            avatarUploader.start();
        });
        avatarUploader.bind('UploadProgress', function(up, file) {
            var data = {
                'width': file.percent + '%'
            };
            $('#uploadPercent').css(data);
            $('#percentNum').text(file.percent + '%');
        });
        avatarUploader.bind('BeforeUpload', function() {
            avatarUploader.disableBrowse(true);
            $('#_j_upload').text('正在上传..').addClass('disable');
            $('#percentContent').show();
            $('#percentNum').text('0%');
            var data = {
                'width': '0%'
            };
            $('#uploadPercent').css(data);
            cropBox.slideDown(700);
        });

        avatarUploader.bind('FileUploaded', function(up, file, response) {
            $('#percentContent').hide();
            var data = $.parseJSON(response.response);
            if(!$.isEmptyObject(data)) {
                avatar = data.id;
                $('<img />')
                    .on('load', function() {
                        cropBox.slideDown(700);
                        cropBox.find('.preview dl img').attr('src', data.url);
                        cropBox.find('.plan img')
                            .attr('src', data.url)
                            .Jcrop({
                                boxWidth: 330,
                                onChange: updatePreview,
                                onSelect: updatePreview,
                                aspectRatio: 1
                            }, function() {
                                cropApi = this;
                                var bounds = cropApi.getBounds();
                                boundX = bounds[0];
                                boundY = bounds[1];

                                var X1 = (boundX / 2) - 115;
                                var Y1 = (boundY / 2) - 115;
                                if(X1 < 0) X1 = 0;
                                if(Y1 < 0) Y1 = 0;
                                var X2 = (boundX / 2) + 115;
                                var Y2 = (boundY / 2) + 115;
                                if(X2 > boundX) X2 = boundX;
                                if(Y2 > boundY) Y2 = boundY;

                                if(X2 - X1 > Y2 - Y1) {
                                    X1 = (boundX / 2) - (Y2 - Y1) / 2;
                                    X2 = (boundX / 2) + (Y2 - Y1) / 2;
                                } else if(X2 - X1 < Y2 - Y1) {
                                    Y1 = (boundY / 2) - (X2 - X1) / 2;
                                    Y2 = (boundY / 2) + (X2 - X1) / 2;
                                }
                                cropApi.animateTo([X1, Y1, X2, Y2]);

                                cropBox.find('.btns a').removeClass('disable');
                            });
                    })
                    .attr('src', data.url);
            } else {
                M.closure(function(require) {
                    var Alert = require('dialog/alert');
                    Alert.pop('图片上传失败，请稍候再试');
                }, true);
            }
            avatarUploader.disableBrowse(false);
            $('#_j_upload').text('选择图片').removeClass('disable');
        });

        cropBox.delegate('.btns .btn1', 'click', function(e) {
            e.preventDefault();
            var self = $(this);
            if(self.hasClass('disable') || cropWidth == 0 || cropHeight == 0) {
                return false;
            }
            cropApi.disable();
            cropBox.find('.btns a').addClass('disable');
            $.post('/home/setting.php/cropAvatar', {
                x: cropX,
                y: cropY,
                width: cropWidth,
                height: cropHeight,
                avatarwidth: boundX,
                avatarheight: boundY,
                avatar: avatar
            }, function(data) {
                if(data) {
                    avatarBox.find('img').attr('src', data);
                    cropApi.destroy();
                    cropBox.slideUp(700);
                } else {
                    cropApi.enable();
                    cropBox.find('.btns a').removeClass('disable');
                    M.closure(function(require) {
                        var Alert = require('dialog/alert');
                        Alert.pop('头像裁剪失败，请稍候再试');
                    }, true);
                }
            });
        }).delegate('.btns .btn2', 'click', function(e) {
            e.preventDefault();
            cropApi.destroy();
            cropBox.slideUp(700);
        });
    });
</script>

