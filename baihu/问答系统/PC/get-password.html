<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>找回密码</title>
    <link rel="stylesheet" href="font/iconfont.css" />

    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/find-pass.css">
</head>
<body>

<!--头部信息-->
<div class="head-wrap">
    <div class="container head clearfix">
        <div class="left head-l">
            <span>你好，欢迎来到白狐医疗问答系统</span>
            <span class="hot-line"><i class="iconfont icon-dianhua1"></i>客服热线    &nbsp;&nbsp;  400-622-2976</span>
        </div>
        <div class="right head-r" >
            <ul class="head-r-list clearfix current">

                <li><a href="javascript:;" class="blue">登录</a></li>
                <li><a href="#">|</a></li>
                <li><a href="javascript:;" class="blue">注册</a></li>
            </ul>

        </div>
    </div>
</div>
<!--找回密码-->
<div class="get-password-box">
    <div class="search-warp">
        <div class="container clearfix">
            <div class="logo left">
                <a href="index.html">
                    <h1><img src="img/logo.png" alt="" /></h1>
                </a>
            </div>
            <div class="left  clearfix user-reg">
                用户登录
            </div>
        </div>
    </div>
    <!--找回密码页面-->
    <div class="login-wrap">
        <div class="container">
            <div class="find-pass clearfix">
                <div class="left find-pass-left">
                    <div class="find-pass-top">
                        <div class="left liucheng1 current">
                            1、验证手机号
                        </div>
                        <div class="left liucheng2">
                            2、重置密码
                        </div>
                    </div>
                    <div class="pass-form current">
                        <dl class="clearfix">
                            <dt class="left">
                                <em class="red">*</em> &nbsp;手机号
                            </dt>
                            <dd class="left">
                                <input type="text" placeholder="请输入手机号" class="phoneVal3"/>
                            </dd>
                            <dd class="left">
                                <button class="getCode send-code3">获取验证码</button>
                            </dd>
                        </dl>
                        <dl class="clearfix">
                            <dt class="left">
                                <em class="red">*</em>
                                &nbsp;验证码
                            </dt>
                            <dd class="left">
                                <input type="text" id="yzm" placeholder="请输入验证码"/>
                            </dd>
                        </dl>
                        <dl class="clearfix">
                            <dt class="left"></dt>
                            <dd class="left"><a href="javascript:;" class="next">下一步</a></dd>
                        </dl>
                    </div>
                    <!--设置密码-->
                    <div class="pass-form setpass">
                        <dl class="clearfix">
                            <dt class="left">
                                <em class="red">*</em> &nbsp;重置密码
                            </dt>
                            <dd class="left">
                                <input type="password" placeholder="请输入新密码" id="newPass"/>
                            </dd>
                            <dd class="left">
                                <span>密码长度为6-16位</span>
                            </dd>
                        </dl>
                        <dl class="clearfix">
                            <dt class="left">
                                <em class="red">*</em>
                                &nbsp;确认密码
                            </dt>
                            <dd class="left">
                                <input type="password" placeholder="请确认新密码" id="newPass2"/>
                            </dd>
                            <dd class="left">
                                <span>密码长度为6-16位</span>
                            </dd>
                        </dl>
                        <dl class="clearfix">
                            <dt class="left"></dt>
                            <dd class="left">
                                <button class="sub">提交</button>
                            </dd>
                        </dl>
                    </div>
                </div>
                <div class="right find-pass-ad">
                    <a href="javascript:;">
                        <img src="img/1.png" alt="" />
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<!--footer-->
<div class="footer">
    <div class="container">
        <div class="footer-top clearfix">
            <a href="javascript:;">首页</a>
            <a href="javascript:;">公司简介</a>
            <a href="javascript:;">在线帮助</a>
            <a href="javascript:;">渠道招商</a>
            <a href="javascript:;">定制服务</a>
            <a href="javascript:;" class="border-right-none">升级计划</a>
        </div>
        <div class="footer-bot">
            <p>Copyright 2010-2015 All Rights Reserved. 苏ICP备123123123号-1（苏）医广[2012]第12-17-659号 苏卫网审（2011）174号</p>
            <p>全国统一客服电话：400-622-2972</p>
        </div>
    </div>
</div>
</body>
</html>
<script src="js/jquery-1.11.2.min.js"></script>
<script src="plug/layer/layer.js"></script>
<script src="js/globle.js"></script>
<script>


    //验证手机
    function register_code3(){
        var myphone=$.trim($('.phoneVal3').val());//手机号码

        if(myphone==""){
            layer.tips('手机号不能为空', $('.phoneVal3'), {
                tips: [1, '#ff5742']
            });
            return false;
        }
        return true;
    }
    var timer3=null; //timer变量，控制时间
    var count3 = 60; //间隔函数，1秒执行
    var curCount3=0;//当前剩余秒数
    var code3 = ""; //验证码
    var codeLength3= 6;//验证码长度
    function sendMessage3() {

        if(!register_code3()){
            return false;
        }
        curCount3 = count3;
        var phone=$.trim($('.phoneVal3').val());//手机号码

        if(phone != ""&&RegExp(/^1\d{10}$/).test(phone)){
            //检测手机是否已经注册
//            $.ajax({
//                url:"{baihu.:U('Findpass/mobiletest')}",
//                type:'post',
//                dataType:'json',
//                async:false,
//                data:{mobile:phone},
//                success:function(data){
//                    moresult = data;
//                },
//            })
//            if (moresult == 1) {
//                layer.tips('该手机号未注册', $('.phoneVal3'), {
//                    tips: [1, '#ff5742']
//                });
//                return false;
//            }
//            //发送手机号
//            $.ajax({
//                url:"{baihu.:U('Sendcode/sendaction')}",
//                type:'post',
//                dataType:'json',
//                data:{phone:phone},
//                success:function(data){},
//            })
            //设置button效果，开始计时
            $(".send-code3").attr("disabled", "true");
            $(".send-code3").text( curCount3 + "s");
            timer = window.setInterval(SetRemainTime3, 1000); //启动计时器，1秒执行一次
            SetRemainTime3();
        }else{

            layer.tips('请输入正确的手机号', $('.phoneVal3'), {
                tips: [1, '#ff5742']
            });

        }
    }

    //timer处理函数
    function SetRemainTime3() {
        if (curCount3 == 0) {
            window.clearInterval(timer3);//停止计时器
            $(".send-code3").removeAttr("disabled");//启用按钮
            $(".send-code3").text("重新发送");
            // code = ""; //清除验证码。如果不清除，过时间后，输入收到的验证码依然有效
        }
        else {
            curCount3--;
            $(".send-code3").text( curCount3 + "s");
        }
    }
    $('.send-code3').on('click',function(){
        sendMessage3();

    });
    $('.next').on('click',function(){
        var code = $.trim($("#yzm").val());

        if(code==""){
            layer.tips('请输入验证码', $('#yzm'), {
                tips: [1, '#ff5742']
            });
        }else{
            $('.liucheng2').addClass('current').siblings().removeClass('current');
            $('.setpass').addClass('current').siblings().removeClass('current');
        }
//        givecode();
//        if(codestate == '-1'){
//            layer.tips(message, '#yzm', {
//                tips: [1, '#ff5742']
//            });
//            return false;
//        }else{
//            window.location.href = "{baihu.:U('Findpass/setpass')}";
//        }

    });

    function givecode()
    {
        var code = $("#yzm").val();
        $.ajax({
            url:"{baihu.:U('Register/givecode')}",
            type:'post',
            dataType:'json',
            async:false,
            data:{code:code},
            success:function(data){
                codestate = data['state'];
                message = data['message'];
            }
        })
    }

    function chnagePass(){
        var pass1 = $.trim($('#newPass').val());
        var pass2 = $.trim($('#newPass2').val());
        if(pass1==""){

            layer.tips('密码不能为空', $('#newPass'), {
                tips: [1, '#ff5742']
            });
            return false;
        }else if(pass1.length<6){
            layer.tips('密码长度未6-16位', $('#newPass'), {
                tips: [1, '#ff5742']
            });
            return false;

        }else if(pass2==""){
            layer.tips('请确认新密码', $('#newPass2'), {
                tips: [1, '#ff5742']
            });
            return false;

        }else if(pass2.length<6){
            layer.tips('密码长度未6-16位', $('#newPass2'), {
                tips: [1, '#ff5742']
            });
            return false;

        }else if(pass1!=pass2){
            layer.tips('两次密码输入的不一致', $('#newPass2'), {
                tips: [1, '#ff5742']
            });
            return false;
        }else{
            return true;
        }


    }


    $('.sub').click(function(){
        if(chnagePass()){
            //修改密码
            var setmobile = $.trim($('.phoneVal3').val());
            var password = $.trim($('#newPass').val());
            $.ajax({
                url:"/Findpass/changepass",
                type:'post',
                dataType:'json',
                async:false,
                data:{mobile:setmobile,password:password},
                success:function(data){
                    passresult = data;
                },
            })
            if (passresult == 1) {
                layer.msg('修改成功!', {icon: 1});
                window.location.href = "/Usercenter/index";
            }else{

            }

        }else{

            return false;
        }

    });

</script>

